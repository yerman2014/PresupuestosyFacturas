
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Factura - Mi Tienda</title>
  
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 40px;
    background-color: #f9f9f9;
    color: #333;
  }
  h1, h3 {
    color: #2c3e50;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    background-color: #fff;
  }
  th {
    background-color: #34495e;
    color: white;
    padding: 10px;
  }
  td {
    border: 1px solid #ccc;
    padding: 8px;
  }
  input, select {
    padding: 8px;
    margin-bottom: 10px;
    border: 1px solid #ccc;
    border-radius: 4px;
  }
  .btn {
    background-color: #2980b9;
    color: white;
    border: none;
    padding: 10px 20px;
    margin-top: 10px;
    border-radius: 4px;
    cursor: pointer;
  }
  .btn:hover {
    background-color: #1c5980;
  }
  .logout {
    background-color: #e74c3c;
  }
  .logout:hover {
    background-color: #c0392b;
  }
  .total {
    font-weight: bold;
    text-align: right;
    margin-top: 20px;
    font-size: 1.2em;
  }
</style>

</head>
<body>
  <h1>Factura - <span id="nombreTienda">Mi Tienda</span></h1>

  <h3>Configuración de la tienda</h3>
  <input type="text" id="tiendaNombre" placeholder="Nombre de la tienda">
  <input type="text" id="tiendaDireccion" placeholder="Dirección de la tienda">
  <button onclick="guardarTienda()">Guardar datos de la tienda</button>

  <h3>Datos del cliente</h3>
  <select id="clienteSelect" onchange="mostrarClienteSeleccionado()"></select>
  <button onclick="mostrarFormularioCliente()">Añadir cliente</button>

  <div id="formCliente" style="display:none;">
    <input type="text" id="clienteNombre" placeholder="Nombre">
    <input type="text" id="clienteDireccion" placeholder="Dirección">
    <input type="text" id="clienteTelefono" placeholder="Teléfono">
    <input type="email" id="clienteEmail" placeholder="Correo electrónico">
    <button onclick="guardarCliente()">Guardar cliente</button>
  </div>

  <div id="datosCliente"></div>

  <table id="factura">
    <thead>
      <tr>
        <th>Producto</th>
        <th>Cantidad</th>
        <th>Precio Unitario (€)</th>
        <th>Subtotal (€)</th>
        <th></th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <button onclick="agregarFila()">Agregar producto</button>

  <div class="total" id="total">Total: €0.00</div>

  
<button class="btn logout" onclick="logout()">Cerrar sesión</button>

<button class="btn" onclick="guardarFactura()">Guardar factura</button>
<button class="btn" onclick="window.print()">Imprimir / Guardar PDF</button>

  <script>
    window.onload = () => {
      cargarTienda();
      cargarClientes();
      agregarFila();
    };

    function guardarTienda() {
      const nombre = document.getElementById("tiendaNombre").value;
      const direccion = document.getElementById("tiendaDireccion").value;
      localStorage.setItem("tiendaNombre", nombre);
      localStorage.setItem("tiendaDireccion", direccion);
      document.getElementById("nombreTienda").textContent = nombre || "Mi Tienda";
      alert("Datos de la tienda guardados");
    }

    function cargarTienda() {
      const nombre = localStorage.getItem("tiendaNombre") || "Mi Tienda";
      const direccion = localStorage.getItem("tiendaDireccion") || "";
      document.getElementById("nombreTienda").textContent = nombre;
      document.getElementById("tiendaNombre").value = nombre;
      document.getElementById("tiendaDireccion").value = direccion;
    }

    function mostrarFormularioCliente() {
      document.getElementById("formCliente").style.display = "block";
    }

    function guardarCliente() {
      const nombre = document.getElementById("clienteNombre").value;
      const direccion = document.getElementById("clienteDireccion").value;
      const telefono = document.getElementById("clienteTelefono").value;
      const email = document.getElementById("clienteEmail").value;
      if (!nombre) return alert("Introduce el nombre del cliente");
      let clientes = JSON.parse(localStorage.getItem("clientes") || "[]");
      clientes.push({ nombre, direccion, telefono, email });
      localStorage.setItem("clientes", JSON.stringify(clientes));
      cargarClientes();
      document.getElementById("formCliente").style.display = "none";
      document.getElementById("clienteNombre").value = "";
      document.getElementById("clienteDireccion").value = "";
      document.getElementById("clienteTelefono").value = "";
      document.getElementById("clienteEmail").value = "";
    }

    function cargarClientes() {
      const select = document.getElementById("clienteSelect");
      select.innerHTML = "";
      let clientes = JSON.parse(localStorage.getItem("clientes") || "[]");
      clientes.forEach((cliente, index) => {
        const option = document.createElement("option");
        option.value = index;
        option.textContent = cliente.nombre;
        select.appendChild(option);
      });
      mostrarClienteSeleccionado();
    }

    function mostrarClienteSeleccionado() {
      const index = document.getElementById("clienteSelect").value;
      let clientes = JSON.parse(localStorage.getItem("clientes") || "[]");
      const cliente = clientes[index];
      if (cliente) {
        document.getElementById("datosCliente").innerHTML = `
          <p><strong>Dirección:</strong> ${cliente.direccion}</p>
          <p><strong>Teléfono:</strong> ${cliente.telefono}</p>
          <p><strong>Email:</strong> ${cliente.email}</p>
        `;
      } else {
        document.getElementById("datosCliente").innerHTML = "";
      }
    }

    function agregarFila() {
      const tabla = document.querySelector("#factura tbody");
      const fila = document.createElement("tr");
      fila.innerHTML = `
        <td><input type="text" placeholder="Producto"></td>
        <td><input type="number" value="1" min="1" onchange="calcularTotal()"></td>
        <td><input type="number" value="0" min="0" step="0.01" onchange="calcularTotal()"></td>
        <td class="subtotal">0.00</td>
        <td><button onclick="eliminarFila(this)">Eliminar</button></td>
      `;
      tabla.appendChild(fila);
      calcularTotal();
    }

    function eliminarFila(btn) {
      btn.closest("tr").remove();
      calcularTotal();
    }

    function calcularTotal() {
      let total = 0;
      document.querySelectorAll("#factura tbody tr").forEach(fila => {
        const cantidad = parseFloat(fila.children[1].children[0].value) || 0;
        const precio = parseFloat(fila.children[2].children[0].value) || 0;
        const subtotal = cantidad * precio;
        fila.children[3].textContent = subtotal.toFixed(2);
        total += subtotal;
      });
      document.getElementById("total").textContent = `Total: €${total.toFixed(2)}`;
    }
  
function logout() {
  localStorage.clear();
  sessionStorage.clear();
  window.location.href = "index.html";
}

function guardarFactura() {
  const factura = [];
  document.querySelectorAll("#factura tbody tr").forEach(fila => {
    const producto = fila.children[0].children[0].value;
    const cantidad = parseFloat(fila.children[1].children[0].value) || 0;
    const precio = parseFloat(fila.children[2].children[0].value) || 0;
    const subtotal = cantidad * precio;
    factura.push({ producto, cantidad, precio, subtotal });
  });
  const total = document.getElementById("total").textContent;
  localStorage.setItem("facturaGuardada", JSON.stringify({ factura, total }));
  alert("Factura guardada en localStorage");
}

</script>
</body>

</html>
