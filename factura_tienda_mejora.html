<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Factura</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }

    header { position: relative; margin-bottom: 20px; }
    h1 { margin: 0; }

    .store-info { position: absolute; top: 0; right: 0; text-align: right; }

    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #000; padding: 6px; text-align: left; }
    th { background: #eee; }

    .total { font-weight: bold; text-align: right; margin-top: 10px; }

    /* ---- Estilos para impresión ---- */
    @media print {
      .btn, .formulario { display: none !important; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Factura <span id="numFactura"></span></h1>
    <div class="doc-info">Fecha: <span id="fecha"></span></div>

    <div class="store-info">
      <strong id="tiendaNombre">Mi Tienda</strong><br>
      <span id="tiendaDireccion">C/ Ejemplo 123</span><br>
      <span id="tiendaTelefono">+34 600 123 456</span><br>
      <span id="tiendaEmail">info@mitienda.com</span>
    </div>
  </header>

  <!-- Datos del cliente -->
  <div class="section-title">Datos del Cliente</div>
  <p><strong>Nombre:</strong> <span id="clienteNombre">Juan Pérez</span></p>
  <p><strong>Dirección:</strong> <span id="clienteDireccion">Av. Central 456</span></p>
  <p><strong>Teléfono:</strong> <span id="clienteTelefono">+34 600 789 123</span></p>
  <p><strong>Email:</strong> <span id="clienteEmail">cliente@mail.com</span></p>

  <!-- Tabla de productos -->
  <div class="section-title">Productos</div>
  <table>
    <thead>
      <tr>
        <th>Producto</th>
        <th>Cantidad</th>
        <th>Precio Unitario (€)</th>
        <th>Total (€)</th>
      </tr>
    </thead>
    <tbody id="productos"></tbody>
  </table>

  <div class="total">Total: <span id="totalFactura">0.00</span> €</div>

  <!-- Formulario de edición -->
  <div class="formulario">
    <h3>Editar datos</h3>
    <label>Nombre Cliente: <input id="inpClienteNombre"></label><br>
    <label>Dirección: <input id="inpClienteDireccion"></label><br>
    <label>Teléfono: <input id="inpClienteTelefono"></label><br>
    <label>Email: <input id="inpClienteEmail"></label><br><br>

    <h3>Agregar producto</h3>
    <label>Producto: <input id="inpProducto"></label>
    <label>Cantidad: <input id="inpCantidad" type="number" value="1"></label>
    <label>Precio: <input id="inpPrecio" type="number" step="0.01"></label>
    <button class="btn" onclick="agregarProducto()">Agregar</button><br><br>

    <button class="btn" onclick="window.print()">Imprimir / Guardar PDF</button>
  </div>

  <script>
    // Fecha actual
    document.getElementById("fecha").textContent = new Date().toLocaleDateString();

    // Número de factura incremental con localStorage
    let numFactura = localStorage.getItem("numFactura") || 1;
    document.getElementById("numFactura").textContent = numFactura;

    // Incrementar número al imprimir
    window.onbeforeprint = () => {
      localStorage.setItem("numFactura", parseInt(numFactura) + 1);
    };

    // Función agregar producto
    function agregarProducto() {
      let prod = document.getElementById("inpProducto").value;
      let cant = parseFloat(document.getElementById("inpCantidad").value);
      let precio = parseFloat(document.getElementById("inpPrecio").value);
      let total = (cant * precio).toFixed(2);

      if (!prod || isNaN(cant) || isNaN(precio)) return;

      let fila = `<tr>
        <td>${prod}</td>
        <td>${cant}</td>
        <td>${precio.toFixed(2)}</td>
        <td>${total}</td>
      </tr>`;
      document.getElementById("productos").insertAdjacentHTML("beforeend", fila);

      // Recalcular total
      let sum = 0;
      document.querySelectorAll("#productos tr td:last-child").forEach(td => {
        sum += parseFloat(td.textContent);
      });
      document.getElementById("totalFactura").textContent = sum.toFixed(2);

      // Limpiar inputs
      document.getElementById("inpProducto").value = "";
      document.getElementById("inpCantidad").value = 1;
      document.getElementById("inpPrecio").value = "";
    }
  </script>
</body>
</html>
