<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Factura - Mi Tienda</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }

    header { position: relative; margin-bottom: 40px; }
    h1 { margin: 0; }

    .store-info {
      position: absolute;
      top: 0;
      right: 0;
      text-align: right;
      font-size: 12px;
      line-height: 1.4;
    }

    .cliente-info {
      margin-top: 20px;
      font-size: 14px;
    }

    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #000; padding: 6px; text-align: center; }
    th { background: #f2f2f2; }

    .total { text-align: right; margin-top: 20px; font-size: 14px; }

    /* ---- Estilos de impresión ---- */
    @media print {
      input, select, button { display: none !important; }
      .print-value { display: inline !important; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Factura</h1>
    <div class="doc-info">Fecha: <span id="fecha"></span></div>

    <!-- Datos de la tienda -->
    <div class="store-info">
      <strong>Mi Tienda</strong><br>
      Calle Ejemplo 123<br>
      46000 Valencia<br>
      Tel: +34 600 123 456<br>
      info@mitienda.com
    </div>
  </header>

  <!-- Datos del cliente -->
  <div class="cliente-info">
    <h3>Cliente</h3>
    <label>Nombre: <input type="text" id="clienteNombre"></label><br>
    <label>Dirección: <input type="text" id="clienteDireccion"></label><br>
    <label>Teléfono: <input type="text" id="clienteTelefono"></label><br>
    <label>Email: <input type="text" id="clienteEmail"></label>
  </div>

  <!-- Tabla de productos -->
  <table id="factura">
    <thead>
      <tr>
        <th>Producto</th>
        <th>Cantidad</th>
        <th>Precio Unitario (€)</th>
        <th>Subtotal (€)</th>
        <th></th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- Totales -->
  <div class="total" id="desgloseTotal">
    Base imponible: €0.00<br>
    IVA (21%): €0.00<br>
    <strong>Total: €0.00</strong>
  </div>

  <!-- Botones de control -->
  <div style="margin-top:20px;">
    <button onclick="agregarFila()">Añadir producto</button>
    <button onclick="window.print()">Imprimir</button>
  </div>

  <script>
    // Fecha actual en factura
    document.getElementById("fecha").textContent = new Date().toLocaleDateString("es-ES");

    let iva = 21; // IVA por defecto

    function agregarFila() {
      const tabla = document.querySelector("#factura tbody");
      const fila = document.createElement("tr");
      fila.innerHTML = `
        <td>
          <input type="text" placeholder="Producto" oninput="actualizarPrintValue(this)">
          <span class="print-value" style="display:none"></span>
        </td>
        <td>
          <input type="number" value="1" min="1" onchange="calcularTotal(); actualizarPrintValue(this)">
          <span class="print-value" style="display:none"></span>
        </td>
        <td>
          <input type="number" value="0" min="0" step="0.01" onchange="calcularTotal(); actualizarPrintValue(this)">
          <span class="print-value" style="display:none"></span>
        </td>
        <td class="subtotal">0.00</td>
        <td><button onclick="eliminarFila(this)">Eliminar</button></td>
      `;
      tabla.appendChild(fila);
      calcularTotal();
    }

    function actualizarPrintValue(input) {
      const span = input.nextElementSibling;
      span.textContent = input.value;
    }

    function calcularTotal() {
      let base = 0;
      document.querySelectorAll("#factura tbody tr").forEach(fila => {
        const cantidad = parseFloat(fila.children[1].children[0].value) || 0;
        const precio = parseFloat(fila.children[2].children[0].value) || 0;
        const subtotal = cantidad * precio;
        fila.children[3].textContent = subtotal.toFixed(2);
        base += subtotal;

        // actualizar valores visibles en impresión
        fila.querySelectorAll("input").forEach(i => actualizarPrintValue(i));
      });

      const ivaImporte = base * (iva / 100);
      const total = base + ivaImporte;

      document.getElementById("desgloseTotal").innerHTML = `
        Base imponible: €${base.toFixed(2)}<br>
        IVA (${iva}%): €${ivaImporte.toFixed(2)}<br>
        <strong>Total: €${total.toFixed(2)}</strong>
      `;
    }

    function eliminarFila(btn) {
      btn.closest("tr").remove();
      calcularTotal();
    }
  </script>
</body>
</html>
