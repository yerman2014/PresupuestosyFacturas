
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Factura Profesional</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; }
    header { display: flex; justify-content: space-between; align-items: flex-start; }
    .emisor, .cliente { width: 45%; }
    .emisor h2, .cliente h2 { margin-bottom: 5px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    .totales { margin-top: 20px; text-align: right; }
    .totales p { margin: 5px 0; }
    .formulario, .acciones { margin-bottom: 20px; }
    input, select { padding: 6px; margin: 5px 0; width: 100%; box-sizing: border-box; }
    button { padding: 10px 20px; margin-top: 10px; }
    @media print {
      .formulario, .acciones, button { display: none !important; }
    }
  </style>
</head>
<body>
  <div class="formulario">
    <h2>Configuración del Emisor</h2>
    <input id="emisorNombre" placeholder="Nombre de la tienda">
    <input id="emisorDireccion" placeholder="Dirección">
    <input id="emisorTelefono" placeholder="Teléfono">
    <input id="emisorNIF" placeholder="NIF/DNI">
    <input id="numeroFactura" placeholder="Número de factura">
    <button onclick="guardarEmisor()">Guardar Emisor</button>

    <h2>Gestión de Clientes</h2>
    <select id="clienteSelect" onchange="mostrarCliente()"></select>
    <button onclick="mostrarFormularioCliente()">Añadir Cliente</button>
    <div id="formCliente" style="display:none;">
      <input id="clienteNombre" placeholder="Nombre">
      <input id="clienteDireccion" placeholder="Dirección">
      <input id="clienteTelefono" placeholder="Teléfono">
      <input id="clienteEmail" placeholder="Email">
      <button onclick="guardarCliente()">Guardar Cliente</button>
    </div>
  </div>

  <header>
    <div class="emisor">
      <h2 id="emisorNombreDisplay">Mi Tienda</h2>
      <p id="emisorDireccionDisplay"></p>
      <p id="emisorTelefonoDisplay"></p>
      <p id="emisorNIFDisplay"></p>
      <p><strong>Factura Nº:</strong> <span id="numeroFacturaDisplay"></span></p>
    </div>
    <div class="cliente">
      <h2>Cliente</h2>
      <p id="clienteNombreDisplay"></p>
      <p id="clienteDireccionDisplay"></p>
      <p id="clienteTelefonoDisplay"></p>
      <p id="clienteEmailDisplay"></p>
    </div>
  </header>

  <table id="tablaProductos">
    <thead>
      <tr>
        <th>Descripción</th>
        <th>Cantidad</th>
        <th>Precio Unitario (€)</th>
        <th>Importe (€)</th>
        <th></th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="acciones">
    <button onclick="agregarProducto()">Agregar Producto</button>
  </div>

  <div class="totales">
    <p id="subtotal">Subtotal: €0.00</p>
    <p id="iva">IVA (21%): €0.00</p>
    <p id="total">Total: €0.00</p>
  </div>

  <div class="acciones">
    <button onclick="window.print()">Imprimir / Guardar PDF</button>
  </div>

  <script>
    function guardarEmisor() {
      localStorage.setItem("emisorNombre", document.getElementById("emisorNombre").value);
      localStorage.setItem("emisorDireccion", document.getElementById("emisorDireccion").value);
      localStorage.setItem("emisorTelefono", document.getElementById("emisorTelefono").value);
      localStorage.setItem("emisorNIF", document.getElementById("emisorNIF").value);
      localStorage.setItem("numeroFactura", document.getElementById("numeroFactura").value);
      mostrarEmisor();
    }

    function mostrarEmisor() {
      document.getElementById("emisorNombreDisplay").textContent = localStorage.getItem("emisorNombre") || "Mi Tienda";
      document.getElementById("emisorDireccionDisplay").textContent = localStorage.getItem("emisorDireccion") || "";
      document.getElementById("emisorTelefonoDisplay").textContent = localStorage.getItem("emisorTelefono") || "";
      document.getElementById("emisorNIFDisplay").textContent = localStorage.getItem("emisorNIF") || "";
      document.getElementById("numeroFacturaDisplay").textContent = localStorage.getItem("numeroFactura") || "";
    }

    function mostrarFormularioCliente() {
      document.getElementById("formCliente").style.display = "block";
    }

    function guardarCliente() {
      const cliente = {
        nombre: document.getElementById("clienteNombre").value,
        direccion: document.getElementById("clienteDireccion").value,
        telefono: document.getElementById("clienteTelefono").value,
        email: document.getElementById("clienteEmail").value
      };
      let clientes = JSON.parse(localStorage.getItem("clientes") || "[]");
      clientes.push(cliente);
      localStorage.setItem("clientes", JSON.stringify(clientes));
      cargarClientes();
      document.getElementById("formCliente").style.display = "none";
    }

    function cargarClientes() {
      const select = document.getElementById("clienteSelect");
      select.innerHTML = "";
      let clientes = JSON.parse(localStorage.getItem("clientes") || "[]");
      clientes.forEach((cliente, index) => {
        const option = document.createElement("option");
        option.value = index;
        option.textContent = cliente.nombre;
        select.appendChild(option);
      });
      mostrarCliente();
    }

    function mostrarCliente() {
      let clientes = JSON.parse(localStorage.getItem("clientes") || "[]");
      const index = document.getElementById("clienteSelect").value;
      const cliente = clientes[index];
      if (cliente) {
        document.getElementById("clienteNombreDisplay").textContent = cliente.nombre;
        document.getElementById("clienteDireccionDisplay").textContent = cliente.direccion;
        document.getElementById("clienteTelefonoDisplay").textContent = cliente.telefono;
        document.getElementById("clienteEmailDisplay").textContent = cliente.email;
      }
    }

    function agregarProducto() {
      const tbody = document.querySelector("#tablaProductos tbody");
      const fila = document.createElement("tr");
      fila.innerHTML = `
        <td><input type="text" placeholder="Descripción"></td>
        <td><input type="number" value="1" min="1" onchange="calcularTotales()"></td>
        <td><input type="number" value="0" min="0" step="0.01" onchange="calcularTotales()"></td>
        <td class="importe">0.00</td>
        <td><button onclick="eliminarProducto(this)">Eliminar</button></td>
      `;
      tbody.appendChild(fila);
      calcularTotales();
    }

    function eliminarProducto(btn) {
      btn.closest("tr").remove();
      calcularTotales();
    }

    function calcularTotales() {
      let subtotal = 0;
      document.querySelectorAll("#tablaProductos tbody tr").forEach(fila => {
        const cantidad = parseFloat(fila.children[1].children[0].value) || 0;
        const precio = parseFloat(fila.children[2].children[0].value) || 0;
        const importe = cantidad * precio;
        fila.children[3].textContent = importe.toFixed(2);
        subtotal += importe;
      });
      const iva = subtotal * 0.21;
      const total = subtotal + iva;
      document.getElementById("subtotal").textContent = `Subtotal: €${subtotal.toFixed(2)}`;
      document.getElementById("iva").textContent = `IVA (21%): €${iva.toFixed(2)}`;
      document.getElementById("total").textContent = `Total: €${total.toFixed(2)}`;
    }

    window.onload = () => {
      mostrarEmisor();
      cargarClientes();
      agregarProducto();
    };
  </script>
</body>
</html>
