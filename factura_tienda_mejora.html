<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<title>Factura / Presupuesto</title>
<style>
  body { 
    font-family: "Segoe UI", Arial, sans-serif; 
    margin: 40px; 
    color: #333; 
    background: #f9f9f9;
  }
  header {
    border-bottom: 2px solid #004080;
    padding-bottom: 10px;
    margin-bottom: 20px;
  }
  h1 {
    font-size: 28px;
    color: #004080;
    margin: 0;
  }
  .doc-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 8px;
    font-size: 16px;
  }
  label {
    font-weight: bold;
    margin-right: 5px;
  }
  input, select {
    width: 100%; 
    box-sizing: border-box; 
    margin-bottom: 10px; 
    padding: 6px;
    border: 1px solid #ccc;
    border-radius: 4px;
  }
  table { 
    width: 100%; 
    border-collapse: collapse; 
    margin-top: 20px; 
    background: #fff;
  }
  th, td { 
    border: 1px solid #ccc; 
    padding: 8px; 
    text-align: left; 
    font-size: 14px;
  }
  th {
    background: #e6f0ff;
    color: #003366;
  }
  .total { 
    font-weight: bold; 
    text-align: right; 
    margin-top: 10px; 
    font-size: 18px;
  }
  .btn { 
    margin-top: 20px; 
    padding: 10px 20px; 
    background: #004080; 
    color: #fff; 
    border: none; 
    border-radius: 4px; 
    cursor: pointer; 
  }
  .btn:hover {
    background: #003366;
  }
  .section-title {
    margin-top: 30px;
    font-size: 18px;
    color: #004080;
    border-bottom: 1px solid #ccc;
    padding-bottom: 5px;
  }
</style>
</head>
<body>
<header>
  <h1 id="tituloDocumento">Factura</h1>
  <div class="doc-info">
    <div>
      <label for="tipoDocumento">Tipo:</label>
      <select id="tipoDocumento">
        <option value="Factura">Factura</option>
        <option value="Presupuesto">Presupuesto</option>
      </select>
    </div>
    <div>
      <label for="numeroFactura">Nº:</label>
      <input id="numeroFactura" type="number" style="width:100px; text-align:right;">
    </div>
  </div>
  <div><strong id="nombreTienda">Mi Tienda</strong></div>
</header>

<h3 class="section-title">Configuración de la tienda</h3>
<input id="tiendaNombre" placeholder="Nombre de la tienda" type="text"/>
<input id="tiendaDireccion" placeholder="Dirección de la tienda" type="text"/>
<button class="btn" onclick="guardarTienda()">Guardar datos de la tienda</button>

<h3 class="section-title">Datos del cliente</h3>
<select id="clienteSelect" onchange="mostrarClienteSeleccionado()"></select>
<button class="btn" onclick="mostrarFormularioCliente()">Añadir cliente</button>
<div id="formCliente" style="display:none; margin-top:10px;">
  <input id="clienteNombre" placeholder="Nombre" type="text"/>
  <input id="clienteDireccion" placeholder="Dirección" type="text"/>
  <input id="clienteTelefono" placeholder="Teléfono" type="text"/>
  <input id="clienteEmail" placeholder="Correo electrónico" type="email"/>
  <button class="btn" onclick="guardarCliente()">Guardar cliente</button>
</div>
<div id="datosCliente" style="margin-top:10px;"></div>

<h3 class="section-title">Productos</h3>
<table id="factura">
  <thead>
    <tr>
      <th>Producto</th>
      <th>Cantidad</th>
      <th>Precio Unitario (€)</th>
      <th>Subtotal (€)</th>
      <th></th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
<button class="btn" onclick="agregarFila()">Agregar producto</button>
<div class="total" id="total">Total: €0.00</div>
<button class="btn" onclick="window.print()">Imprimir / Guardar PDF</button>

<script>
  window.onload = () => {
    cargarTienda();
    cargarClientes();
    agregarFila();
    cargarNumeroFactura();
    actualizarTitulo();
    document.getElementById("tipoDocumento").addEventListener("change", actualizarTitulo);
  };

  function actualizarTitulo() {
    const tipo = document.getElementById("tipoDocumento").value;
    document.getElementById("tituloDocumento").textContent = tipo;
  }

  function guardarNumeroFactura() {
    const numero = document.getElementById("numeroFactura").value;
    localStorage.setItem("numeroFactura", numero);
  }

  function cargarNumeroFactura() {
    const numero = localStorage.getItem("numeroFactura") || "1";
    document.getElementById("numeroFactura").value = numero;
  }

  function guardarTienda() {
    const nombre = document.getElementById("tiendaNombre").value;
    const direccion = document.getElementById("tiendaDireccion").value;
    localStorage.setItem("tiendaNombre", nombre);
    localStorage.setItem("tiendaDireccion", direccion);
    document.getElementById("nombreTienda").textContent = nombre || "Mi Tienda";
    alert("Datos de la tienda guardados");
  }

  function cargarTienda() {
    const nombre = localStorage.getItem("tiendaNombre") || "Mi Tienda";
    const direccion = localStorage.getItem("tiendaDireccion") || "";
    document.getElementById("nombreTienda").textContent = nombre;
    document.getElementById("tiendaNombre").value = nombre;
    document.getElementById("tiendaDireccion").value = direccion;
  }

  function mostrarFormularioCliente() {
    document.getElementById("formCliente").style.display = "block";
  }

  function guardarCliente() {
    const nombre = document.getElementById("clienteNombre").value;
    const direccion = document.getElementById("clienteDireccion").value;
    const telefono = document.getElementById("clienteTelefono").value;
    const email = document.getElementById("clienteEmail").value;
    if (!nombre) return alert("Introduce el nombre del cliente");
    let clientes = JSON.parse(localStorage.getItem("clientes") || "[]");
    clientes.push({ nombre, direccion, telefono, email });
    localStorage.setItem("clientes", JSON.stringify(clientes));
    cargarClientes();
    document.getElementById("formCliente").style.display = "none";
    document.getElementById("clienteNombre").value = "";
    document.getElementById("clienteDireccion").value = "";
    document.getElementById("clienteTelefono").value = "";
    document.getElementById("clienteEmail").value = "";
  }

  function cargarClientes() {
    const select = document.getElementById("clienteSelect");
    select.innerHTML = "";
    let clientes = JSON.parse(localStorage.getItem("clientes") || "[]");
    clientes.forEach((cliente, index) => {
      const option = document.createElement("option");
      option.value = index;
      option.textContent = cliente.nombre;
      select.appendChild(option);
    });
    mostrarClienteSeleccionado();
  }

  function mostrarClienteSeleccionado() {
    const index = document.getElementById("clienteSelect").value;
    let clientes = JSON.parse(localStorage.getItem("clientes") || "[]");
    const cliente = clientes[index];
    if (cliente) {
      document.getElementById("datosCliente").innerHTML = `
        <p><strong>Dirección:</strong> ${cliente.direccion}</p>
        <p><strong>Teléfono:</strong> ${cliente.telefono}</p>
        <p><strong>Email:</strong> ${cliente.email}</p>
      `;
    } else {
      document.getElementById("datosCliente").innerHTML = "";
    }
  }

  function agregarFila() {
    const tabla = document.querySelector("#factura tbody");
    const fila = document.createElement("tr");
    fila.innerHTML = `
      <td><input type="text" placeholder="Producto"></td>
      <td><input type="number" value="1" min="1" onchange="calcularTotal()"></td>
      <td><input type="number" value="0" min="0" step="0.01" onchange="calcularTotal()"></td>
      <td class="subtotal">0.00</td>
      <td><button class="btn" style="padding:5px;" onclick="eliminarFila(this)">X</button></td>
    `;
    tabla.appendChild(fila);
    calcularTotal();
  }

  function eliminarFila(btn) {
    btn.closest("tr").remove();
    calcularTotal();
  }

  function calcularTotal() {
    let total = 0;
    document.querySelectorAll("#factura tbody tr").forEach(fila => {
      const cantidad = parseFloat(fila.children[1].children[0].value) || 0;
      const precio = parseFloat(fila.children[2].children[0].value) || 0;
      const subtotal = cantidad * precio;
      fila.children[3].textContent = subtotal.toFixed(2);
      total += subtotal;
    });
    document.getElementById("total").textContent = `Total: €${total.toFixed(2)}`;
  }
</script>
</body>
</html>
